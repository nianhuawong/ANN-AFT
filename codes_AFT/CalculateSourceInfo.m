function SourceInfo = CalculateSourceInfo(AFT_stack,Coord, type)
disp('设置热源...');
if nargin == 2
    type = 1;
end
% type = input('设定SourceInfo的方法（1-人工设置，2-图中点选，3-根据BC设置）：');
%%
if type == 1
    % cylinder
%     SourceInfo = [0.0538215439836736,0.992679968196325,0.216238036847884,1;-0.988310277855043,0.107485220105512,0.216238036847883,1;0.994137957154360,9.71445146547012e-17,0.216238036847883,1;0.0538215439836737,-0.992679968196325,0.216238036847883,1;-10,9.65517241379310,0.689655172413794,1;10,9.65517241379310,0.689655172413794,1;-10,0,0.689655172413794,1;-10,-9.65517241379310,0.689655172413794,1;0,-10,0.689655172413794,1;9.65517241379310,-10,0.689655172413794,1;10,0,0.689655172413794,1;0,10,0.689655172413794,1];
    % naca0012
%     SourceInfo = [7.86000583927177e-05,-0.00141868732844787,0.000341698235673445,1;0.0198899081370586,0.0232029592285870,0.00327561073542767,1;0.0198899081369985,-0.0232029592285563,0.00327561073541480,1;0.0878834091136851,0.0440781950876226,0.00900020482704302,1;0.0878834091136032,-0.0440781950876076,0.00900020482701678,1;0.226973203698406,0.0580352738055096,0.0173666275304776,1;0.226973203698283,-0.0580352738055047,0.0173666275304823,1;0.388508142043173,0.0576397380580376,0.0220639481310222,1;0.388508142043129,-0.0576397380580391,0.0220639481310297,1;0.574796652657813,0.0467071373175450,0.0234126275351175,1;0.574796652657855,-0.0467071373175419,0.0234126275351216,1;0.789975693794523,0.0262554659670992,0.0154350731146075,1;0.789975693794600,-0.0262554659670906,0.0154350731146112,1;0.920801497332546,0.0106930942000992,0.00655226080956893,1;0.920801497332645,-0.0106930942000864,0.00655226080956960,1;0.997059707541746,-0.000416313013308304,0.000502050061118350,1;0.499997942677448,5.48122414639082,0.908373346753772,1;-4.96249358435749,-0.452635123272018,0.908372800195656,1;0.500000000000001,-5.48121471153668,0.908372800195656,1;5.96249358435749,-0.452635123272017,0.908372800195654,1;-4.08869342595688,2.99793981994327,0.908374165617938,1;-3.53266072281087,-3.71232571424770,0.908372800195657,1;4.53266072281087,-3.71232571424770,0.908372800195658,1;5.08868039818107,2.99793454305439,0.908371297327431,1];%   SourceInfo_line =  [];    
    %30p30n
    
    %SourceInfo =[-0.0147700569643760,-0.0604275109116863,0.000299999573848296,1;-0.0363671882574024,-0.0363649060073824,0.00560720360089609,1;-0.0195440356328552,-0.0329364786094180,0.00640787748289984,1;0.00978605314923905,0.00219273957394699,0.000555472194272516,1;0.0247803148442974,-0.0110607693518286,0.000958448495947904,1;0.0350786707202089,-0.0179773315177821,0.00327688691883608,1;0.0398329136073908,0.0103518789646996,0.00450280523598390,1;0.168611704194490,0.0327212069116374,0.0166167567033382,1;0.171299070899302,-0.0301298062523383,0.0170865903963767,1;0.329501133152444,0.0329802248774462,0.0164922665379774,1;0.325773277135136,-0.0211326371465355,0.0106452443043030,1;0.390766678319095,-0.00969755806813999,0.000799999754896442,1;0.392493546530429,0.0179737389475938,0.00106802047805751,1;0.487249494250722,0.0171910501934295,0.000494293110769679,1;0.488382303043535,0.00799342537970411,0.000799711303898955,1;0.519668917079024,0.00679576342558083,0.00758708008427061,1;0.506309446768369,-0.0139526904704649,0.00759094323649253,1;0.575240982496231,-0.0439537297633815,0.0115762688384742,1;0.591440221506961,-0.0406342196304214,0.0107649755482303,1;0.630631775000000,-0.0808773525000000,0.00163226686026674,1;-0.0467673823897789,-0.0589266044966848,0.00455199060318319,1;0.499997942677448,5.48122414639082,0.908373346753772,1;-4.08869342595688,2.99793981994327,0.908374165617938,1;-4.96249358435749,-0.452635123272018,0.908372800195656,1;-3.53266072281087,-3.71232571424770,0.908372800195657,1;0.500000000000001,-5.48121471153668,0.908372800195656,1;4.53266072281087,-3.71232571424770,0.908372800195658,1;5.96247488712023,0.452629025052335,0.908363734230878,1;4.53266571509613,3.71233053108664,0.908373942970335,1];
    SourceInfo =[-0.0473335848962421,-0.0543893982933547,0.00491532055079076,1;-0.0147700569643760,-0.0604275109116863,0.000299999573848296,1;-0.0214333841130887,-0.0580866886495524,0.00230993112963473,1;-0.0223151580784422,-0.0625337020820174,0.00157213607137689,1;-0.0195440356328552,-0.0329364786094180,0.00640787748289984,1;-0.0245731447896751,-0.0249638283083770,0.00522395959409983,1;-0.000703316688620921,-0.00532288498156689,0.00241966294318272,1;0.00978605314923905,0.00219273957394699,0.000555472194272516,1;0.0247803148442974,-0.0110607693518286,0.000958448495947904,1;0.0290901247452392,0.00163893980675815,0.00258946997146431,1;0.0350786707202089,-0.0179773315177821,0.00327688691883608,1;0.0440206777972744,0.0127347215917322,0.00513824529140543,1;0.0533093434992928,-0.0210440561051818,0.00620629531066758,1;0.0688527595870216,0.0224226535060980,0.00839365074046902,1;0.137260829550684,0.0310027941253258,0.0147325100853524,1;0.221435184575726,0.0343281334435017,0.0183817159960541,1;0.329501133152444,0.0329802248774462,0.0164922665379774,1;0.223814533914834,-0.0301235560166982,0.0175308308901949,1;0.335684997607193,-0.0195778006340359,0.00942088977042312,1;0.391160000000000,-0.00922477100000000,0.000800000000000000,1;0.391160000000000,0.0175386000000000,0.000799999999999999,1;0.399368937821539,0.0285855524142134,0.0113295803941302,1;0.449204927538055,0.0232766682897349,0.00573600821768878,1;0.487249494250722,0.0171910501934295,0.000494293110769679,1;0.448847843989082,0.0187310082921462,0.00738956857718062,1;0.491689579791788,0.0108214060422562,0.00169888257092336,1;0.502824519340684,0.0117505837790097,0.00429451338356730,1;0.487002147631551,0.00275750383585108,0.00216308972530689,1;0.494734681563800,-0.00859256060423958,0.00526618721210494,1;0.527171292566511,0.00349055959015588,0.00881671217258227,1;0.522802654538063,-0.0201302047164741,0.00999254544805740,1;0.585007797870300,-0.0493760022608896,0.0107686339527189,1;0.582815291778434,-0.0335394854601475,0.0115720205953336,1;0.631291651686403,-0.0781899661325121,0.00160000635668866,1;0.621366461518619,-0.0741911998754496,0.00407408455046618,1;0.138674632498956,-0.0289327327251918,0.0154516334167199,1;0.499997942677448,5.48122414639082,0.908373346753772,1;-4.08869342595688,2.99793981994327,0.908374165617938,1;-4.96249358435749,-0.452635123272018,0.908372800195656,1;-3.53266072281087,-3.71232571424770,0.908372800195657,1;0.500000000000001,-5.48121471153668,0.908372800195656,1;4.53266072281087,-3.71232571424770,0.908372800195658,1;5.96247488712023,0.452629025052335,0.908363734230878,1;4.53266571509613,3.71233053108664,0.908373942970335,1];
    %SourceInfo = [-0.0147009000000000,-0.0602557100000000,0.000298953977060015,1;-0.0473335848962421,-0.0543893982933547,0.00491532055079076,1;-0.0239670460640271,-0.0528580052787484,0.00369667490999232,1;-0.0195440356328552,-0.0329364786094180,0.00640787748289984,1;-0.0324788537636523,-0.0323573283395824,0.00556298749373066,1;-0.0171074182436136,-0.0185038429131778,0.00462367449849985,1;-0.0128504625891193,-0.0218393845318452,0.00640919499132984,1;0.00778923085085973,0.000355236062566341,0.00134814931920963,1;0.0244964478595071,-0.00941008154908006,0.000799734598997809,1;0.0309988879227220,0.00366474149903225,0.00298291389165647,1;0.0350786707202089,-0.0179773315177821,0.00327688691883608,1;0.0546743268228690,0.0176097775075657,0.00662274703573148,1;0.0599362045322913,-0.0220031521196449,0.00718553299786815,1;0.0980156590803755,0.0278630115483167,0.0114904123797980,1;0.0975797036789077,-0.0260987452754872,0.0119043135962930,1;0.152461618867340,0.0319153393203957,0.0157241084320684,1;0.138674632498956,-0.0289327327251918,0.0154516334167199,1;0.203261672728233,0.0339443473649610,0.0179738509150572,1;0.206211153743395,-0.0304204069965079,0.0176824203255050,1;0.276938880438358,0.0344181034400173,0.0183340972544181,1;0.273685411560439,-0.0273680175298047,0.0154514859503835,1;0.345521611974163,0.0322431743801556,0.0155828454909432,1;0.335684997607193,-0.0195778006340359,0.00942088977042312,1;0.387532161222479,0.0295525577738528,0.0124231140087630,1;0.391559860712725,0.0179491393123013,0.000799999166712096,1;0.391160000000000,-0.00922477100000000,0.000800000000000000,1;0.419815670333680,0.0266572711601878,0.00922879050751031,1;0.426263613629542,0.0186968382935806,0.00720233472384569,1;0.443132953326135,0.0240404291155114,0.00650368978933420,1;0.441314458773753,0.0187797344811103,0.00767767458215732,1;0.459232451536928,0.0219397061690324,0.00441539027793020,1;0.462336542549009,0.0184556181585903,0.00599834501334815,1;0.479326940631272,0.0176917655206461,0.00265492371064530,1;0.487996859043009,0.0171421125859392,0.000270917421496203,1;0.488382303043535,0.00799342537970411,0.000799711303898955,1;0.498974795136338,0.0121030854918630,0.00345070256253146,1;0.494734681563800,-0.00859256060423958,0.00526618721210494,1;0.532549075809905,-0.0240222551663763,0.0109978513315644,1;0.544642451782277,-0.00599453297465501,0.0109925278084384,1;0.573582879312441,-0.0261883803297121,0.0120316017760796,1;0.564751880088884,-0.0385371503158304,0.0120364009215216,1;0.611770761412501,-0.0587646140129294,0.00728407911404061,1;0.607913533102053,-0.0641211706714598,0.00728608334124835,1;0.630631775000000,-0.0808773525000000,0.00163226686026674,1;0.626308184880312,-0.0731784230673331,0.00326511018696819,1;0.624212160830216,-0.0765081013478928,0.00326546252297396,1;0.499997942677448,5.48122414639082,0.908373346753772,1;-4.08869342595688,2.99793981994327,0.908374165617938,1;-4.96249358435749,-0.452635123272018,0.908372800195656,1;-3.53266072281087,-3.71232571424770,0.908372800195657,1;0.500000000000001,-5.48121471153668,0.908372800195656,1;4.53266072281087,-3.71232571424770,0.908372800195658,1;5.96249358435749,-0.452635123272017,0.908372800195654,1;5.08868039818107,2.99793454305439,0.908371297327431,1];
plot(SourceInfo(:,1),SourceInfo(:,2),'b.','MarkerSize',15)
elseif type == 2
    %% 在计算域中点选几个点源
    X=[];Y=[];
    button = 1;
%     axis([-10 10 -10 10])     %cylinder
%     axis([-0.2 1.2 -0.1 0.1])   %naca0012
%     axis([-0.7 0.7 -0.1 0.1]) %rae2822
axis([-0.2 0.8 -0.1 0.1]) %30p30n
    while (button~=3)
        [x1,y1,button] = ginput(1);   %前面的点源用鼠标左键选择，最后一个点源用鼠标右键选择
        plot(x1,y1,'b*')
        X = [X;x1];
        Y = [Y,y1];
        if button == 2
            axis tight; axis equal;
        end
    end
    
    nBoundaryFaces = size(AFT_stack,1);
    nSources = size(X,1);
    SourceInfo = zeros(nSources,4); % 存储点源的位置、强度、强度因子
    
    for k = 1:nSources
        xSource = X(k);
        ySource = Y(k);
        
        minDist = 1e40;
        for i = 1:nBoundaryFaces
            node1 = AFT_stack(i,1);
            node2 = AFT_stack(i,2);
            
            xcoord = 0.5 * ( Coord(node1,1) + Coord(node2,1) );
            ycoord = 0.5 * ( Coord(node1,2) + Coord(node2,2) );
            
            dist = sqrt( ( xcoord - xSource )^2 + ( ycoord - ySource )^2 ) + 1e-40;
            if dist < minDist
                minDist = dist;
                index = i;
                xNode = xcoord;
                yNode = ycoord;
            end
        end
        
        %     SourceInfo(k,1) = xSource;
        %     SourceInfo(k,2) = ySource;
        SourceInfo(k,1) = xNode;
        SourceInfo(k,2) = yNode;
        SourceInfo(k,3) = AFT_stack(index,5);
        SourceInfo(k,4) = 1.0;
    end
    SourceInfo
    
elseif type == 3
    %% 直接采用所有边界阵面作为点源，貌似不行?
    nBoundaryFaces = size(AFT_stack,1);
    SourceInfo = zeros(nBoundaryFaces,4); % 存储点源的位置、强度、强度因子
    
    for i = 1:nBoundaryFaces
        node1 = AFT_stack(i,1);
        node2 = AFT_stack(i,2);
        
        xcoord = 0.5 * ( Coord(node1,1) + Coord(node2,1) );
        ycoord = 0.5 * ( Coord(node1,2) + Coord(node2,2) );
        
        sp = sqrt(3.0)/2.0 * DISTANCE( node1, node2, Coord(:,1), Coord(:,2));
        
        intensity = 1.0;      % 强度因子暂时默认为1.0
        SourceInfo(i,:)=[xcoord, ycoord, sp, intensity]; % 存储点源的位置、强度、强度因子
    end       
end
end
%% 矩形算例
%  SourceInfo = [-4, 4, 0.9, 1;
%                -4,-4, 0.9, 1;
%                 4,-4, 0.9, 1;
%                 4, 4, 0.9, 1;
%                 0, 0, 0.01, 5;
%                 2, 2, 0.01, 1;
%                 -2, -2, 0.01, 1];
%% 圆柱算例
%  SourceInfo = [
%  0 0 0.3 1
%  -10, 10, 2.2, 1;
%  -10,-10, 2.2, 1;
%  10,-10, 2.2, 1;
%  10, 10, 2.2, 1;
%  ];

%% NACA0012 quadBC
%  SourceInfo = [-10, 10, 2.2, 1;
%                -10,-10, 2.2, 1;
%                 10,-10, 2.2, 1;
%                 10, 10, 2.2, 1;
%                 0,  10, 2.2, 1;
%                 0, -10, 2.2, 1;
%                 -10, 0, 2.2, 1;
%                 10,  0, 2.2, 1;
%                 -0.5, 0, 0.015, 1;
%                  0.5, 0, 0.015, 1;
%                   0, 0, 0.06, 1];

