function [Y,Xf,Af] = myNeuralNetworkFunction(X,~,~)
%MYNEURALNETWORKFUNCTION neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 03-Jul-2020 10:19:47.
%
% [Y] = myNeuralNetworkFunction(X,~,~) takes these arguments:
%
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = Qx8 matrix, input #1 at timestep ts.
%
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = Qx2 matrix, output #1 at timestep ts.
%
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-10;-10;-10;-10;-10;-10;-10;-10];
x1_step1.gain = [0.1;0.1;0.1;0.1;0.1;0.1;0.1;0.1];
x1_step1.ymin = -1;

% Layer 1
b1 = [-2.098422984459189955;1.9942396655023066909;0.97255101529032539354;3.1264932422858904282;1.0642997471610480265;0.89581338365326534934;-2.2815656719976389333;-1.2607235483062173564;-1.6469087135819613366;0.10147559578121259638;0.3433629257968270343;-0.59264769826432805999;-0.06250887915347563828;-0.039899376706966076245;-0.97524636860133617766;-1.4235583186957094792;-0.10737050154729628482;1.4222057464881321387;0.27015406935900004859;0.063013537878437886341;0.70643753334658565546;-1.0918099942329408947;-0.20430613392419882945;0.32448328446790014601;-0.092994942247911049904;-0.69419268976262193949;-0.014302532279667204071;-0.82052250176254581948;-1.056043568416073386;-1.1786075930834616354;2.0738437561668114917;-1.0916800279702356669;1.1772810127793136292;1.1182007322942113525;0.98483180262116820636;-2.0485322196500694858;-0.066119637256177171691;1.5750750554509134194;1.3793699932452847534;-3.7227984836813043934];
IW1_1 = [-0.20425099968537988038 5.2509681205816480798 -0.59013819533203326628 0.056635827175167859082 0.063647500257681954849 -1.9999216445391396757 1.0180144642464354909 0.00098419846255976841352;-0.03001377326420206354 1.6339932782206907369 0.068228369064514779452 0.024167544324779043075 -0.014939088707120802557 -0.9759455329248915012 0.65044819960484934196 -0.10214903035715548751;-0.024906457314221110838 -0.34273129395521501062 0.1627563777782810861 0.10475081207196708377 -0.030175703929293053868 -0.0062274067341610249426 1.0023635627954015082 0.027584304777821332111;0.090576331988453426258 -0.5431954850244106181 1.561791024744744405 -0.42001695474662942287 0.0064773252880959393887 -1.0903934359967748513 -2.7557190477777595561 0.071438495136570939748;0.068988486088395362117 -2.2723630323229335737 -0.28003390213260909158 -0.059123925783467416728 0.028164007344054740878 0.36059665901396109611 0.068421504205032096513 0.14214642843010272255;-0.044550903163274951924 -2.6741709939547533281 0.054737304311228765497 -0.0036357360543953182001 0.024280499638272303592 -4.6408914697095102753 5.1815404009644332461 0.21378513465320794773;-0.15613315683329359596 0.86485287840923530389 0.45917968180624718633 0.11009534924984949733 -0.026734580238873980468 -2.9856340756000379066 4.3523004988937916693 -0.061366959307117656397;0.0581523378347831299 1.9919528603560165969 -2.6028030185432564636 -0.079403624574259215607 -0.090415396360298133649 -0.96085219562500556734 0.5665061454216161474 0.018507931645901243983;-0.12294058178117422964 -3.600805807922057955 2.8610835633685298696 0.3048992509803563622 0.1392184548403525568 -1.3205505545943607704 3.2755199723334711415 0.2130006528692142409;-0.0011005872587439276353 -3.6482596291097815211 3.5580830793838500448 0.050256080334045813429 0.083402650412965156912 1.4325218499066580957 -1.4415044736428634931 0.03873705858768301119;-0.35947568043736005672 -2.966120700952563638 0.15227897857213318344 0.6164269272720389603 -0.59756216748887680534 2.2416448517226981174 0.68590397135587477528 1.0028616678041046839;-0.066820356880700759739 -2.4992917182414671196 3.4498330627705420248 0.11006303377673037902 0.073494489432085946534 0.77122025290807993958 -0.24430631063921814938 0.00076143521977827628364;0.023931629144445309282 0.38418510521385762502 -0.2519711932649749131 -0.041423816831568198438 -0.0056229034638881634015 -0.22987979791186377576 -0.011037496223582368704 0.0020349967376716046434;-0.080676836734268647655 5.0153888248996674193 -4.7709898300349165012 -0.075996695692577970194 -0.09402521568535970875 -7.0901551574099164199 7.3229959776470341382 -0.053888170757231589059;0.13011880647149687285 1.6170868581541451015 -2.5164646167072608485 -0.29162682987559196413 -0.11681363365822110267 3.1355058886532845008 -5.8125091304865925679 0.3242936624820655922;-0.04393545684087504094 0.71046030817008964942 0.79283373898927000933 0.071263679612725158719 0.055733746749564390399 1.4181237541970757032 -1.4306729864004994468 -0.10518398308163655341;0.034316442829147912608 -8.7293271713837956582 8.4147228621386780389 0.50327786571820465333 0.066553759920887869961 3.5165868702620080022 -0.1426040801028668481 0.00083336084189371360115;-0.15357740777832448731 -0.95942259498016202457 4.5425726066825884431 0.35293424924202959625 0.1683983190781146444 -2.0275500647839259649 2.5765405169949757713 -0.2527923092146430184;-0.0094307301634023888576 -1.0000390801877427904 0.91095008030540447486 0.00074825477252611985197 0.012286197968974111455 -0.87813885483075337923 0.89581113047509752789 0.021471489443953273302;-0.03940764789742497165 -3.0762793413397622189 3.1272016784896647934 -0.033507525316473905919 0.032636639639247372324 -4.7729388573517246286 4.711774652631793181 0.03034766663420187735;0.15327993561062730477 2.0060578954494707737 -4.3599356717736279521 -0.16835277054335925917 -0.13296698118474423178 -2.1850458323985715303 1.9925913012684746128 0.15986490439692802035;0.0065471396977966308042 1.3867524933429202783 -0.56039534764169673942 -0.0076499848254569105879 -0.03853494696874412706 -0.40926476333310446432 0.13956994485729773414 -0.051719171605059621744;-0.047171530827670636599 0.55747251899876426595 -0.8419912381051474215 0.33381629874408175196 -0.049920841614225663907 1.0774515846458165846 0.86589851877056178697 0.1407799808683118381;-0.39513284690007965949 -4.0862242056299775683 1.1705614943942674877 0.69681298460880758405 -0.63424496174122213521 -0.94116311313539890993 4.0279697899518147608 0.97847149088858675903;-0.0069281566238639201438 6.3564830553237401389 -6.3065275799568238924 -0.048079169622410405927 -0.10176222413608421169 -1.0171780747198397865 1.1353861994053260354 -0.059697783291590388044;-0.056463975220628542795 -3.0002167534401107396 2.557339668509201136 0.1411393218540260841 0.039226968997737511613 0.6539142300469974467 0.61333738683595306895 -0.0068018974190241724559;0.048309062675770564343 -3.5302061008807230635 3.2663407106625452769 0.043023173884857629501 0.084740943278867900124 4.0195480355776664894 -4.4212915187168349007 0.063768581917491268252;-0.039234948281269305115 -1.7193269600307865552 -0.60879402596610254772 -0.031050357615604286948 0.056161806267202955822 -0.66185385211267699912 1.0905499150358353155 0.17793718545114256546;-0.10481147772660281969 -2.6669992411116942854 -0.1929697839921321878 0.025525533741642122271 0.05017775694667148817 -3.2431053228746402617 3.7576924799569861868 0.26882227791045182341;-0.13638296539299343824 -2.8219918876841036948 -0.46494325842435979546 0.056460938036185751021 0.078443464836581655586 -2.9711279934902989908 3.5483868369614017801 0.30105166948998923759;0.21648082292770473578 1.7638363420555642769 -1.1375896219988812508 -0.38900580139975549088 -0.092523569687458506738 -1.4175972012106563547 -2.088047295537662329 -0.1739094242824357206;-0.10688537143371952542 -2.2998044309619074532 -0.79031475171412324254 0.015518472675362106686 0.084527264307621391426 -1.6278413919305547708 2.1785763354182505758 0.26188175728220852712;-0.1363354607494688675 -1.1685659937879129266 4.1562342673368446455 0.27937432322247035543 0.13723727248509087762 -0.9336366943903167126 1.4336154106350258441 -0.20566224517913780923;-0.32630299653082472933 -9.0377631795981514529 7.8042505416830447729 0.54448386769759204995 0.12262322371182264591 4.0549223650546135644 -0.76371964752554166722 -0.1999656270857077256;-0.12058676023532020893 -1.458105310128513743 3.992913467299639585 0.22713849047429546246 0.11970531920318927543 -0.082270426042179614634 0.52613529422211968711 -0.16618775792065074159;-0.21700156554519170471 -2.2680741876308756488 1.6322744220876370669 0.3729063959166850073 0.10167497607887192312 1.3875929626279437379 2.1073614414544832307 0.15827211261409615539;0.069849260342343580388 -2.3057300936798652558 1.0378919752312050218 -0.002851776641365592023 -0.014957409875135212196 1.7951029425226938674 -1.5887312781766549374 0.05495198712059019136;-0.07265462621964340062 -3.0575038121528019808 3.6791590641263121064 0.095106209945250416715 0.12726299203069957322 1.3896719788201266077 -0.54407976178405437206 -0.028646530843980184261;0.050188733957837072808 4.745017678415480944 -5.4637783672972668469 -0.08509600481061269095 -0.14233500150316891197 -2.0001789231562239202 2.0084100831776705576 -0.0086415032196817589266;-0.13505272529087233857 0.75324309931819755093 -1.4174664352126320477 0.52021905671247936631 0.051529266681697570573 2.2977694551350849039 1.4772964183342680577 0.1994576147882400341];

% Layer 2
b2 = [-1.6531686048876850226;-0.20487818120937598132];
LW2_1 = [0.0077671478489303672627 0.25380155356305289516 0.25694652057472955331 0.027821273011307941225 0.072541313805597834596 -0.054688626767897312309 0.10213919543593565076 -1.5054268927739533623 0.046683643693189967594 -1.1969372398846387373 -0.032898306746697074388 0.16306387972345584569 2.5808233501463848647 -0.50582032029566736941 0.014065940128262293882 0.43357042132214301811 -0.010385983059562496969 0.27123072978727102988 5.4171059986356802085 -1.1481754634938046156 -0.081942397423405477497 0.022666528221990053099 0.021321879696323913639 0.034258660249926818631 -0.27373638068851124938 0.11553999042643062212 -0.57466113400764273766 0.020035852620903592258 -0.17806098824042784767 0.075097016023014259711 -0.25581892732420230541 0.035461815223686077303 -0.87447953439762837746 0.010368287198761969026 0.74874304956233639352 -0.27462380441730349645 -0.17271422254748458602 -0.49614560193549867018 -0.17182003621632066515 0.015440902676933449672;0.045910036361206350841 -0.89044013981846437122 0.90206592709303923261 0.034909139118919962907 0.31863110326228027969 -0.025004117200434480828 0.14024945534774369005 -2.7931011525899362979 -0.034526637218813764629 -2.8011370358302567496 0.019081717168774693649 0.32902731551721153824 3.0232027193005914789 -0.40212533931812427523 0.01965150570119485185 0.19118453205482191515 -0.034354096063620463697 0.30226755741928884591 -5.1558530118495911054 0.72423987601001782455 -0.13176295831114523405 -2.2672597620135825913 0.16657417095200113821 -0.014905111351031473388 -1.486202836407112704 0.42295238350433550512 -0.65428334266187948565 1.7994029733744212329 -0.9376289970234148452 1.4714097141696818039 -0.71977869726941734463 -1.6969376801459776782 -1.0749529299124702675 0.023412820833787803543 1.0070582767757547682 -0.68057878618021094841 0.16300036341923093697 -0.84183187446746166049 -0.48070506663654999358 0.14172597337814188401];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = [0.1;0.1];
y1_step1.xoffset = [-10;-10];

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
    X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},1); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS
    
    % Input 1
    X{1,ts} = X{1,ts}';
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = repmat(b2,1,Q) + LW2_1*a1;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a2,y1_step1);
    Y{1,ts} = Y{1,ts}';
end

% Final Delay States
Xf = cell(1,0);
Af = cell(2,0);

% Format Output Arguments
if ~isCellX
    Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
y = bsxfun(@minus,x,settings.xoffset);
y = bsxfun(@times,y,settings.gain);
y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
x = bsxfun(@minus,y,settings.ymin);
x = bsxfun(@rdivide,x,settings.gain);
x = bsxfun(@plus,x,settings.xoffset);
end
