function [Y,Xf,Af] = net_hybrid_20201130(X,~,~)
%MYNEURALNETWORKFUNCTION neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 30-Nov-2020 15:47:19.
%
% [Y] = myNeuralNetworkFunction(X,~,~) takes these arguments:
%
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = Qx8 matrix, input #1 at timestep ts.
%
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = Qx8 matrix, output #1 at timestep ts.
%
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.keep = [1 4 5 8];
x1_step2.xoffset = [-2.05969244815767;-0.458413185817906;-2.15139100765146;-2.96433394200652];
x1_step2.gain = [0.572871090192172;0.521103159091411;0.490249420819243;0.41065523144853];
x1_step2.ymin = -1;

% Layer 1
b1 = [1.9703022119393889255;5.7622914683213224407;3.9915786739251370996;-1.84279185679663704;1.7836485956448784318;4.0042539661615803581;-4.6108866996207718003;-3.9407176719626368921;0.011896276571838407254;0.075707897571294507921;0.7498196049825224252;5.93100926671665718;-1.2965697308774415397;1.4825409806413891722;1.0290779198755062307;2.3727380590597006993;-0.0022873847379079092004;0.11326532884374392041;-0.97496939031095541939;10.368662885119572792;-1.1782253141046155065;-0.35718043083338335553;-5.2171869619954831521;-6.6596171460154414135;1.4243131750439328442;16.567357172131295329;1.6043175846565904674;-1.9336918372769364982;-0.60173167991176557123;0.07721984721869173951];
IW1_1 = [-0.056176108393272299046 -1.0441099158474660413 -0.37023603230765100847 4.6909950182955890696;-5.5545924569236220236 -1.9035608205507743573 0.87639810952708541159 -5.5576583801101078208;-0.26331116874605953182 0.39713652685131894948 -0.32590458618332918128 -5.3606566029220843461;2.759047073835501962 -0.24227219659344706448 6.1958247395417425096 -0.26899205045031321371;-0.92628345306317549923 0.24934981333102082535 -2.2931123846526610954 0.12774411568014454321;-4.9436400319850957175 -4.6151540030753670507 1.3433363195390357614 -6.297441131198930897;14.263235832057837627 -0.052172627815716562938 13.244314529025981386 -0.19692899685598733162;4.7171264210350596358 4.3511798852739422827 -1.304602606787031549 6.0911366548730327963;-0.0064006407479837955365 0.58214801988630049401 -0.079235151270801926215 -1.7673163519255696841;0.13113846915987648067 0.096212344610787314814 -4.487405330890360311 -0.011226815528407740538;-0.56946870202136390393 0.11779753292334628478 1.6856864360945569281 0.30382059893036988951;0.13946159573534286369 11.664167270025926015 -0.061865639141658670952 -11.451462786048265841;-0.11915463018315881893 4.1580550445018875649 -0.057831725400940586779 2.6189795282690182532;-4.4524321653935219345 -2.7910734543911108752 -3.5722376206365806794 2.7076992007732796353;3.2662407328417986108 0.14463258836427431153 -2.0328187563448536501 0.10465353459441202599;-3.1770737613511257358 0.27677734542807119755 -7.7546119349370048468 0.21088247216167960163;-0.10168685633467708374 -0.25032018037953612799 0.53201559466773618023 0.43827745084244879026;-0.097997300148572510925 -0.12403657753763847049 5.6889224202493355875 -0.037186756002014799416;-2.9421287643237818976 -0.13837164976983051812 1.5579530432123740447 -0.13152215329086464068;4.3931607021498626509 11.439333399063890795 -9.4163316581137603833 2.5925915688678990989;-0.068203004000895003922 3.8082918855151892679 -0.069001087384321896367 2.1279192736588941059;-0.46350914800069697996 -0.056212691905903305889 3.3941963799091974252 -0.064807796949862231384;-5.6729781885256249652 -13.652178371819264413 -11.655217594429075234 -7.2874318531784556541;-5.049344850540874674 -0.16436173839454246148 9.5318072163755065418 0.071997548591066412582;-0.036765884933871034734 0.099587456813786071064 -0.038806914553211876995 -2.1289059966616474817;-11.565846663111670978 12.782526436307625417 -11.109754429966836042 -13.272990602671809413;1.4171099903213262294 9.5151268655367857718 1.4333008228230412762 -1.5355923040138497182;-0.064349790801999914858 0.16515449363297554641 2.3766577562716006966 -1.6211293931638903754;-0.046823748172392799793 -0.062364703445555169647 -0.23477132653307133947 1.2237472111298879351;0.015428981648447760364 -1.0455177434444977713 0.021516131813934358252 3.4352500169291868559];

% Layer 2
b2 = [0.96871958235854971342;0.48076221024120285863;1.5518578423678335287;1.3367370078102123188;-0.57836842173574976034;-0.74696767010650522156;-0.44178375563214339339;-0.23288015100009312741];
LW2_1 = [-0.22315928785725666628 0.0049727135621303979185 -0.35106426526999751081 2.1313424256608071161 -1.0915533680298399322 0.5757551457875450529 -0.23446723829832333275 0.51969073829567613565 -3.4610512497745062888 -3.4782008955111520798 0.29493627038567482579 -0.12304169791678189194 -0.28360657003875888726 0.082939643549303304626 2.7564063299282448583 1.6699679070503514744 -4.6417091387157318749 -1.9788641476479169601 3.5616673651586654437 0.19816834320986326246 0.38829911455612320381 -1.206644321472623016 0.12468251412427495961 0.013285025640983882944 0.41740663809477662749 0.11910475230194830787 0.042704141398191217127 0.099048965163422264535 -0.96250143441997415561 -0.82325233769227779135;1.6625424504107877421 -0.39138504180132138721 0.7829032534754964967 0.4260412580081611722 0.25174033092842085235 -1.9738220646540538539 -0.089045538674381904953 -2.1695823029789891301 3.5112719992693874893 3.2651065117364952428 1.2278976707872324425 -0.24448747175717133739 3.3284284965848733862 -0.11176550024084062895 -0.11906126546055983972 0.47938618297248342115 -5.0692696378160890802 1.5628424203781854374 -0.23660169752522691722 0.088237605240573030452 -3.9907731112413133978 2.2247891974012539151 0.004279038331352643873 0.1209305975179227749 -4.4899835821798665947 -0.078132771984370838481 -0.03363000808055788271 1.2993683307188332865 -3.0462314782972508276 3.0197815058399983812;0.87120066901198922604 -0.1840272862687083455 0.94920950900533096473 0.6333009526451237603 -0.49834561970022683841 -0.5734575532649109908 0.04635877321391657091 -0.60173223667632735889 6.6626333282231691157 3.6092519145513746182 -0.50114968219456601517 0.015064114668647318046 1.0233593783950940548 -0.011206052197152992916 -0.028227504341371584262 0.76235051473181625337 2.2526652808805938122 1.8691209861746111986 -0.043362298048972236497 0.0018403680910948226526 -1.3181868341546378876 1.7444197443837352601 -0.0083542794363592638718 -0.051478430655661551463 -2.7190802515348795332 -0.0018231176013082082705 -0.049673583646500069078 0.12623535188432488674 1.3277356039587617786 2.5696705651910423107;0.65618037410057583614 -0.074064403829467981288 0.45452337944719606311 -0.44980048187720289565 -0.075904724222458877514 -0.38073857356827917053 0.052538751092784753693 -0.35997522032633583189 7.1620583921432983132 2.8582076400672251637 -0.69842651365709629285 0.077413344302055778212 0.78011307519579098368 0.03498460407466283395 -0.074425156995890279221 -0.28784963253937972949 4.2959462819699911762 1.5893007919613180157 -0.36903104209740983377 -0.1151814485973947505 -0.91738434968810200765 1.2375953154673664525 -0.012206608087339190435 -0.091692896035134252575 -1.3896744588378606711 0.0088487950946726182805 -0.1040410774489994028 0.027839299911704740859 2.7206907744553250339 2.2527390715705957192;-0.041898290844394753263 0.51392238894801878235 -0.59865648604910393082 2.3013066553675298742 0.31042655942635938304 0.74723345257294138122 -0.5708071019001176305 0.80044726043777691959 -3.8715566929595608414 0.15405454755085190577 0.33160416944401643891 0.63255386033179572536 -1.3255119711824396855 0.50868545595131497983 0.95488870091763278225 2.1307273537848439027 -3.5457873881301154029 0.37016227950762892185 1.2746834459445446353 0.36935236978261415386 1.6613026481022332703 -0.39296942977659682361 0.058010882591619787607 0.1769383958284039271 -2.0335768631536783602 -0.52348517772171732076 0.19524370719062725255 1.0119943217723958995 -5.7991446211317922987 -0.28996532329901125724;-0.11975290449648992586 -0.12465139105901781869 -0.34875861745910191614 -2.0761037919218310321 0.0024390347706275258485 -0.1089252464487014127 0.69991241007381144179 -0.13224606919059023191 -0.61449876174808382157 -0.82667903508476714425 0.10762927064770166918 0.13033583925588917984 -0.054358632629039914386 -0.29887909901925951983 -0.41672077552515657262 -1.9807472980807661056 -0.075029234965903343624 -0.58870080310897343612 -0.51707671085341222472 -0.36338403074687680716 0.070967825914443463664 -0.07262500960575525577 -0.0050048571096750690823 -0.29166501014991780272 0.97727298608224200116 0.77129083794628683357 -0.065283638216652964403 -0.099140807646632564398 0.9828004010794112455 -0.46905819062410397668;-0.039750978514692239529 -0.52082151817397148719 0.66293046656036458408 0.056870047895876511823 -0.37251448031909650815 -0.63268847792069149438 -0.16662989037935874159 -0.67952183577796554381 3.4455033888935813202 0.40921728836395071527 -0.40672598224675776679 -0.74192225779828724352 1.2469833846666942279 -0.26703754542073832035 -0.71728059034676350247 0.087942164672806702463 3.448477155212473555 0.1244897334847006598 -0.89435011519896268073 -0.12819928138614461455 -1.5367042974100284525 0.20525423314118515505 -0.058098397546282126713 0.21674817851722272266 1.7113859500143528969 0.73289496236194429102 -0.1333239149305940896 -1.0622777033736769958 4.8154945704468605783 0.30755223441510720628;0.20140217670298379837 0.13155051950500384894 0.28448464336409284847 -0.28207291114232030393 0.059648884470766425081 -0.0056197261778820851649 0.037524582252746206679 0.011320647335105982548 1.0405521116123181979 0.26340719438786636131 -0.032507464919689699201 -0.020967441182576554426 0.13288722854823004083 0.057231189126051906779 0.1791126657521118215 -0.23792222041095700824 0.17233951187239038294 0.094048788473194450122 0.13674337961974825095 0.1222309421395500334 -0.19556618768485195536 0.26034020061525858791 0.0050923719780009346278 -0.10202156465623384018 -0.65508206810968205858 -0.98070062284011860765 0.0033638458275392201652 0.14942418411956454039 0.00084968145665131195043 0.45147128989282958589];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = [0.807088816911435;0.836879258419127;1.24274786314385;1.25316427979481;2;2;2;2];
y1_step1.xoffset = [-1.0465476448263;-0.458413185817906;0.309971594150446;0.309971594150446;0;0;0;0];

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
    X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},1); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS
    
    % Input 1
    X{1,ts} = X{1,ts}';
    temp = removeconstantrows_apply(X{1,ts},x1_step1);
    Xp1 = mapminmax_apply(temp,x1_step2);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = repmat(b2,1,Q) + LW2_1*a1;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a2,y1_step1);
    Y{1,ts} = Y{1,ts}';
end

% Final Delay States
Xf = cell(1,0);
Af = cell(2,0);

% Format Output Arguments
if ~isCellX
    Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
y = bsxfun(@minus,x,settings.xoffset);
y = bsxfun(@times,y,settings.gain);
y = bsxfun(@plus,y,settings.ymin);
end

% Remove Constants Input Processing Function
function y = removeconstantrows_apply(x,settings)
y = x(settings.keep,:);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
x = bsxfun(@minus,y,settings.ymin);
x = bsxfun(@rdivide,x,settings.gain);
x = bsxfun(@plus,x,settings.xoffset);
end
