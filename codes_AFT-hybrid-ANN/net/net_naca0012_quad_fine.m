function [Y,Xf,Af] = net_naca0012_quad_fine(X,~,~)
%NET_NACA0012_QUAD_FINE neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 09-Aug-2020 11:27:55.
% 
% [Y] = net_naca0012_quad_fine(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 8xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 4xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_remove = [2 3 6 7];
x1_step1_keep = [1 4 5 8];
x1_step2_xoffset = [-2.05969244815767;-0.458413185817906;-2.15139100765146;-2.96433394200652];
x1_step2_gain = [0.572871090192172;0.521103159091411;0.490249420819243;0.410655231448531];
x1_step2_ymin = -1;

% Layer 1
b1 = [-1.4671745512019032;-2.9908450682616441;0.22874377793901363;-4.116671747136941;-0.45700555249674624;-0.11289368840337262;0.36558193446814435;0.49887051340165439;-1.2915290570783935;2.3187012949755865;-1.5334280304870649;-0.61165422090666322;0.88172949466150874;3.4433073465619111;-8.3430581463907707];
IW1_1 = [-0.3324143914124717 -0.093225429251909464 4.1273660001015475 0.22504686027825396;0.46714737242534826 1.2818764943375622 -0.38073402688300545 4.6418660866969814;0.39167145636115214 -1.8730922945874116 0.47682099842449821 -0.7171167474925989;0.32906355601295145 -0.6635080574358454 -0.22957472428123374 6.7795994608863035;-0.34834089943875268 0.28902320863584541 3.7430973479744023 -0.37036777645002833;-0.25411318595961901 0.12687508137498321 -1.672046901024312 -0.011264664847533324;0.57560776299552441 -0.12384886697480467 -2.5819787077730618 0.27894707848673944;-1.110034431820965 0.25341959108792594 0.39203351208032955 3.7822740183892649;-1.9876158940533377 -0.19342450360370148 1.5996897434819721 0.14038586427348687;3.2022987223932073 -0.79992224559947267 2.8768140640478101 6.9478061506971871;-3.8166777237591347 1.233226721341709 -3.0858475387052615 -4.6649730623230381;1.3112880910006215 -0.4510050248670745 -0.42961538530445798 -4.5714930820102504;-5.3523219690837518 -2.0653172188509501 -0.44863756718093806 2.1939634958179632;-2.0277320799249385 -2.2219260813102402 5.5979546710758799 -3.7732330709582613;-7.7194402727304876 -11.650729196152179 5.4562184901223008 -2.5401934074231711];

% Layer 2
b2 = [2.5039886325137739;-1.0719652762041914;1.6965355810518477;1.485360225846829;2.6761077717845545;1.5568834268989475;0.18034525769701626;-3.0935017797378963];
LW2_1 = [-0.63381332663143686 0.37115333049922528 -1.267482722251992 0.59668758021744461 1.7947535381506288 0.14858611833157878 1.1152151392059904 -6.9824189922837006 0.13277442367296141 2.2162765776027538 1.9479134593950924 -5.1344955731795272 0.0049148376030020103 0.1604716552320711 0.076468468432490416;-0.34067980589622576 0.68635772513316906 0.85497034444571218 0.16940687992452458 1.5921221205221721 -0.90959391637848641 2.7759327036477894 5.1128927124931796 0.64907982841120615 -1.2606207955151343 -0.95529534231666424 4.3973266274776082 0.42272130227822402 0.20549998900109198 0.061423132480379554;0.3155582512249766 0.19063950257434376 0.56797536182230268 -0.24622911744558781 -1.2653480453822608 4.7590448106556975 -3.3163567642807235 3.7616810467166149 0.25721701862564517 -1.3630871311957662 -1.2029261924181474 2.9542212471871432 -0.18710519237361692 0.62126155473264999 0.015689796191070891;-5.0042485932626617 0.60476914836815987 1.0473123643889193 -1.8731855743465551 1.9781866421531447 0.099476868911385283 1.3672679894871675 5.3585932114944068 7.2683219019749519 -0.65180419085462016 -0.42767835481216177 3.9931655465112352 0.063956438281718597 -0.89782996948863947 -1.2740900456505695;0.062651767018909038 -0.055902859816648151 0.20971809195374932 0.24077422900646644 -0.91148663322170176 8.0952845597508585 -2.1206403324522722 1.4611418513531389 0.091564572831778018 -2.261406152913275 -2.40437976768921 1.2350374353177014 -0.19422260217988507 3.6886373931548717 0.034097491159771065;-0.1771390722020971 7.2262690733736781 -1.3422541098251792 -5.7822201613130728 1.2755425046912972 -4.68723474173302 4.5281378857104544 -14.324830062763043 1.1206546076766699 0.92003670590589637 0.61521881433228098 -11.307723143855309 0.82679010007208587 0.31134937100718635 0.085074823475355749;0.14171840297479149 -0.42814596297906427 -0.15684466935766556 0.36707150002102329 -0.78704604161120184 2.1231268681540079 -2.413425899108431 1.2864768840467851 -0.20850595284019102 -0.082617238636568141 0.010917523960491938 1.1719680888062565 -0.29706970389394155 0.025050060159038857 0.038536736329427029;-1.1224735655253797 -1.8929189819164609 -0.69288841146456048 0.74238811512377734 -3.1170698894911024 -2.977598195856328 -3.6700822047846082 -1.735670255293585 -0.54604466394676321 0.15412477775916442 0.18569409027845399 -1.3696112028270901 0.17585692655776611 -1.2841140806392652 -0.39947711221438448];

% Layer 3
b3 = [-1.358096751334843;-0.99543704358491125;0.75677184415342535;1.0593619450919125];
LW3_2 = [-0.22435229760759967 -0.24987943269951382 -0.83199496323414579 0.47415769517119827 -0.37205500420738263 -0.050211195251819267 0.64384201167054134 -2.4589625025581876;0.60871069912665787 -0.58793560353590335 0.25441075510394467 0.058090378554543187 -0.55391790097278459 -0.48177696524219038 -0.72644513355810425 -0.32079044846008808;0.36534946329103141 0.16743867187049757 0.43380271709384516 -0.022095532414019441 -1.0762431883535286 -0.072136976983856668 0.17771203631473378 0.44806562052597443;0.44964082924866067 0.47489477661526491 0.45822620796297747 -0.13991539232015338 -0.66490706614927586 0.04396447382761437 0.14363672457216992 0.99514213833453347];

% Output 1
y1_step1_ymin = -1;
y1_step1_gain = [0.807088816911435;0.836879258419127;1.24274786314385;1.25316427979481];
y1_step1_xoffset = [-1.0465476448263;-0.458413185817906;0.309971594150446;0.309971594150446];

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    temp = removeconstantrows_apply(X{1,ts},x1_step1_keep,x1_step1_remove);
    Xp1 = mapminmax_apply(temp,x1_step2_gain,x1_step2_xoffset,x1_step2_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = repmat(b3,1,Q) + LW3_2*a2;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a3,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(3,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Remove Constants Input Processing Function
function y = removeconstantrows_apply(x,settings_keep,settings_remove)
  if isempty(settings_remove)
    y = x;
  else
    y = x(settings_keep,:);
  end
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
x = bsxfun(@minus,y,settings_ymin);
x = bsxfun(@rdivide,x,settings_gain);
x = bsxfun(@plus,x,settings_xoffset);
end
